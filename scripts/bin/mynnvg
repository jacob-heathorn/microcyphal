#!/bin/bash

set -e

pushd $PROJECT_ROOT/scripts/package

DSDL_PATH=~/.cyphal/uavcan
OUT_PATH_CPP=$PROJECT_ROOT/.bin/generated/cpp

echo "DSDL_PATH: $DSDL_PATH"
echo "OUT_PATH_CPP: $OUT_PATH_CPP"

# Create output directory if it doesn't exist
mkdir -p "$OUT_PATH_CPP"

# Generate C++ version only
echo "Generating C++ version..."
poetry run nnvg \
    --target-language cpp \
    --language-standard c++17 \
    --include-experimental-languages \
    --outdir "$OUT_PATH_CPP" \
    --lookup-dir "$DSDL_PATH" \
    --jobs 4 \
    --verbose \
    "$DSDL_PATH/node/7509.Heartbeat.1.0.dsdl"

echo "Generated C++ files:"
find "$OUT_PATH_CPP" -name "*.hpp" | head -10
